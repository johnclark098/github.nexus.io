<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="tablestyle.css">
        <link rel="stylesheet" href="mapstyle.css">
        <link rel="stylesheet" href="events.css">
        <link rel="stylesheet" href="modalimage.css">
        <link rel="stylesheet" href="collapsiblestyle.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.min.js"></script>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="menu.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    </head>
  
 <body onload="startLoad()" style="background-color: lightgray;">
 <!-------------------------------------------------------------------------------------------------------->
    <div id="mySidenav" class="sidenav" >
        <img src="userlogo.png"   class="userlogo" >
        <label id="username" class="usertext" img src="iconlatest.png" >
        </label>
        <label id="accountlist" class="accountlisttext"  > 
        </label>
        <hr>
       <!-- <a href="javascript:voidnavActive(0)" class="closebtn" onclick="closeNav()">&times;</a>-->
        <a href="#"  id="nav1"class = "navActive">   <i style="right: 4px;top: 5px; position: relative;" class="material-icons" >gps_fixed</i>  Tracking Shipments</a>
       <!--  <a href="#" id="mapLabel">  <i class="material-icons">local_shipping</i> Shipment Tracker</a>-->
        <a href="#" id="nav2" ><i class="material-icons"style="right: 4px;top: 5px; position: relative;" >announcement</i> Door & Shock</a>
        <a href="#"id="nav3" ><i class="material-icons"style="right: 4px;top: 5px; position: relative;" >location_on</i> Set Location</a>
        <a href="#"id="nav4" ><i class="material-icons"style="right: 4px;top: 5px; position: relative;" >notification_important</i> Notifcations</a>
        <a href="#"id="nav5" ><i class="material-icons"style="right: 4px;top: 5px; position: relative;" >settings</i> Manage Roles</a>
        <a href="#"id="nav6" ><i class="material-icons"style="right: 4px;top: 5px; position: relative;" >logout</i> Log Out</a>
    </div>
<!--------------------------------------------------------------------------------------------------------> 
<!-------------------------------------------------------------------------------------------------------->   
    <div id="home" style="display: none;">
        <div id="over_map3">
            <span><label style="font-size: 22px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; font-weight: bold;">
            Check Container Status: </label></span>
        <span > 
        <!-- 
            <select id="shipmentPos" style="position: relative; width: 100px; font-size: 16px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; ">
        </select>  -->    
        </span>
        <button id=followShip class="btn" onclick="btnFollow()"><i class="fa fa-search"></i></button>
        </div>  
    </div>
<!-------------------------------------------------------------------------------------------------------->
    <div id="map" style="height:100%; width:  85.3%;  position: relative;  margin-left: 14.6%; "></div>
    <div id="map2" style="height:50%; width:  85.3%;  position: relative;  margin-left: 14.6%;display: none;"  ></div>
    <div id="eventMap" style="height:100%; width:  85.3%;  position: relative;  margin-left: 14.6%;display: none;"></div>

    <div id="over_map">
        <span><label style="font-size: 12px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; font-weight: bold;">Active Shipments: </label></span>
            <span id="cars" style="font-size: 12px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; font-weight: bold;">0</span>
    </div>
    <div id="over_map3">
        <span > Track Shipment:
            <select id="shipmentPos" class ="shipmentDropdown"   >
                <option >All</option>
            </select>    
        </span>
    </div>   
   
    <div id="eventChoose">
        <span > Choose Shipment:
            <select id="shipmentPos2" class ="shipmentDropdown"> 
                <option value="" selected disabled>Choose here</option>
            </select>    
        </span>
    </div> 
<!-------------------------------------------------------------------------------------------------------->
    <div id=barchartContents >

        <h2 style=" font-size: 22px; 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
        font-weight: bold; 
        text-align: left; 
        color: black;">Door Occurence Graph</h2>
    <label id="refreshLabelID" class="refreshLabel2">Refresh to update new data</label>
    <img src ="tracker.jpg" id=refreshButton >

    <canvas id="doorChart" width="800" height="450"></canvas>
    <h2 style=" font-size: 22px; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
    font-weight: bold; 
    text-align: left; 
    color: black;">Shock Occurence Graph</h2>
    <canvas id="shockChart" width="800" height="450"></canvas>
    </div>
 <!-------------------------------------------------------------------------------------------------------->
 <div id="notifID" class="notifClass">
        
</div>
 <!-------------------------------------------------------------------------------------------------------->
 <div id=rolesContents >
  


 
    <div id="rolesInfo">

        <div   class="my-custom-scrollbar2"id="style-4" style="height: 550px;">
            <table  id="table7" style="height: 350px; position: relative; bottom: 50px; ">
                <thead>
                    <tr class="header">
                        <th onclick="sortTable7(0)" style="width:5%; ">ID</th>
                        <th onclick="sortTable7(1)" style="width:10%;">Name</th>
                        <th   style="width:10%;">Tracking</th>
                        <th   style="width:10%;">Door & Shock</th>
                        <th  style="width:10%;">Geofencing</th>
                        <th   style="width:10%;">Notifcations</th>
                        <th   style="width:10%;">Manage Roles</th>
                        <th   style="width:10%;">Command</th>
                    </tr>
                    <tr>
   
                    </tr>
                </thead>
             <tbody>
             </tbody>
            </table>
        </div>

    </div>
       

    <input type = text placeholder="Input employee name to add" id="addempText"
    style="font-size: 15px; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    border-radius: 10px;
    padding: 5px;
    width: 300px;
    outline: none;
    margin: 5px;
    text-align: center;
    bottom: 0;
    position: absolute;">
    <img src="add.jpg" onclick="addEmp()"style="width: 3.5%;
     bottom: 0;
     margin-bottom: 4px;
     left: 320px;
    position: absolute;">
</div>
<!-------------------------------------------------------------------------------------------------------->

<!-------------------------------------------------------------------------------------------------------->
<div id = shipmentDetails style="display: none;  margin-left: 15%;" >
    <!--<a href="#" id = back><i id = back class="fa fa-arrow-left" ></i></a>-->
    <h2 style="left: 20px;"></h2>
    <button class="collapsible">Request Snapshots Section</button>
    <div class="content">
        <div id=imageContents2>
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Camera Snapshots</h2>
          <label id = lblsnapshot class= lblsnapshotclass style="font-size: 30px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold;
            position: relative;
            top: 150px;
            left: 380px; display: none;" >Waiting for the pictures. . .</label> 
            <div class="my-custom-scrollbar" id="style-4" style="position: relative; height: 520px;">
                <table id = "List2" style="bottom:20px; position: relative;"  >
                    <tbody>
                        <tr>
                        </tr>
                    </tbody>
                    </table>
            </div>
         </div>
         <a button id = "startBtn" onclick="startCam()" class="buttonShipment2">Start</a>
         <a id = "stopBtn"onclick="deleteall()" class="buttonShipment2">Delete All</a>
    </div>

    <button class="collapsible">Inventory Section</button>
    <div class="content">
        <div id=productContents >
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Inventory Table</h2>
            <ul id= "list">
            </ul>
            <input type="text" id="myInput4" type="text" onkeyup="filterTable4()" placeholder="Find data. . ." />
                <div class="my-custom-scrollbar2" style="height: 250px;" id="style-4">
                    <table  id="table4">
                        <thead>
                            <tr class="header">
                                <th onclick="sortTable4(0)" style="width:5%; ">ContainerID</th>
                                <th onclick="sortTable4(1)" style="width:10%;">ProdID</th>
                                <th onclick="sortTable4(2)" style="width:10%;">Description</th>
                                <th onclick="sortTable4(3)" style="width:10%;">Latitude</th>
                                <th onclick="sortTable4(4)" style="width:10%;">Longitude</th>
                            </tr>
                        </thead>
                     <tbody>
                     </tbody>
                    </table>
                </div>
         </div>    
    </div>

    <button class="collapsible">Monitoring Section</button>
    <div class="content">
        <div id=shipmentsContents  >
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Monitoring Table</h2>
            <ul id= "list">
            </ul>
            <input type="text" id="myInput3" type="text" onkeyup="filterTable3()" placeholder="Find data. . ." />
              <div class="my-custom-scrollbar2" style="height: 250px;" id="style-4">
                  <table  id="table3">
                        <thead>
                            <tr class="header">
                                <th onclick="sortTable3(0)" style="width:5%; ">ContainerID</th>
                                <th onclick="sortTable3(1)" style="width:10%;">Date</th>
                                <th onclick="sortTable3(2)" style="width:10%;">Time</th>
                                <th onclick="sortTable3(3)" style="width:10%;">Celsius</th>
                                <th onclick="sortTable3(4)" style="width:5%;">Humidity</th> 
                                <th onclick="sortTable3(5)" style="width:10%;">Latitude</th>
                                <th onclick="sortTable3(6)" style="width:10%;">Longitude</th>
                             </tr>
                        </thead>
                    <tbody>
                     </tbody>
                    </table> 
                </div>
         </div>
         <div id=chartContents >
            <canvas id="myChart"></canvas>
         </div>
        </div>

    <button class="collapsible">Shock Section</button>
    <div class="content">
        <div id=shockContents>
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Shock Table</h2>
            <ul id= "list">
            </ul>
            <input type="text" id="myInput5" type="text" onkeyup="filterTable5()" placeholder="Find data. . ." />
            <div class="my-custom-scrollbar2" style="height: 250px;" id="style-4">
                <table  id="table5">
                        <thead>
                            <tr class="header">
                                <th onclick="sortTable5(0)" style="width:5%; ">Occurence</th>
                                <th onclick="sortTable5(1)" style="width:10%;">Date</th>
                                <th onclick="sortTable5(2)" style="width:10%;">Time</th>
                                <th onclick="sortTable5(3)" style="width:10%;">Latitude</th>
                                <th onclick="sortTable5(4)" style="width:10%;">Longitude</th>
                                <th onclick="sortTable6(5)" style="width:10%;">Camera Snapshots</th> 
                            </tr>
                        </thead>
                    <tbody>
                     </tbody>
                    </table>
                </div>
         </div>
           
        <div id=imageContents3>
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Shock Camera Snapshots</h2>
            <div class="my-custom-scrollbar" id="style-4" style="position: relative; height: 520px;">
                    <table id = "List3"  >
                        <tr>
                        </tr>
                    </table>
            </div>
        </div>
    </div>
    <button class="collapsible">Door Section</button>
    <div class="content">
        <div id=doorContents>
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Door Status Table</h2>
            <ul id= "list">
            </ul>
            <input type="text" id="myInput6" type="text" onkeyup="filterTable6()" placeholder="Find data. . ." />
            <div class="my-custom-scrollbar2" style="height: 250px;" id="style-4">
                <table  id="table6">
                        <thead>
                                <tr class="header">
                                    <th onclick="sortTable6(0)" style="width:5%; ">Occurence</th>
                                    <th onclick="sortTable6(1)" style="width:10%;">Start Time</th>
                                    <th onclick="sortTable6(2)" style="width:10%;">End Time</th>
                                    <th onclick="sortTable6(3)" style="width:10%;">Camera Snapshots</th> 
                                </tr>
                        </thead>
                    <tbody>
                     </tbody>
                    </table>
                </div>
         </div>

         <div id=imageContents>
            <h2 style=" font-size: 22px; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif ; 
            font-weight: bold; 
            text-align: left; 
            color: black;">Door Camera Snapshots</h2>
              <div class="my-custom-scrollbar" id="style-4" style="position: relative; height: 520px;">
                    <table id = "List"   >
                        <tr >
                        </tr>
                    </table>
              </div>
            </div>
        </div>  
     <!-- The Modal -->
     <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
      </div>
    </div>  

<!-------------------------------------------------------------------------------------------------------->
    <script>
        function startLoad()
        {
            var userID = localStorage.getItem("id");
            
            var employeeUpdateMain =firebase.database().ref().child('/accounts/employee/"'+String(userID)+'"');
            employeeUpdateMain.on("child_changed", function (snapshot) {
  
                location.reload(true);
            });
            employeeUpdateMain.once('value', function(snapshot) { 
            
           if(snapshot.val().track !=1)
        
            {
              
                $("a#nav1").hide();
                $("div#map2").hide(); 
                $("div#map").hide(); 
                $('div#over_map3').hide();
                $("div#over_map").hide();  

            }
            if(snapshot.val().doorshock !=1)
            {
                $("a#nav2").hide();
                $('div#barchartContents').hide();
                $("div#snapshotsID").hide();
            }
            if(snapshot.val().geo !=1)
            {
                $("a#nav3").hide();
                $("div#eventChoose").hide(10);
                $("div#eventMap").hide(10);
            }
            if(snapshot.val().notif !=1)
            {
                $("a#nav4").hide();
                $("div#notifID").hide(10); 
            }
            if(snapshot.val().roles!=1)
            {
                $("a#nav5").hide();
                $("div#rolesContents").hide();
            }
            });  
            
           
            var tempshockTable5 = firebase.database().ref().child("shockTable/");
            var tempdoorTable6 = firebase.database().ref().child("doorTable/");
            tempshockTable5.on("child_changed", function (snapshot) {
            
            $("label#refreshLabelID").text("Refresh to update new data");     
            $("label#refreshLabelID").show();
            });
            tempdoorTable6.on("child_changed", function (snapshot) {
 
            $("label#refreshLabelID").text("Refresh to update new data");   
            $("label#refreshLabelID").show();  
            });
          
            if(localStorage.getItem("role") == null)
            {
              window.location.href="file:///D:/Yuro/tempNexus/login.html";     
            }
            $("label#accountlist").text(localStorage.getItem("role"));    
            if(localStorage.getItem("username").length >=11)
            {
                var usertxt = localStorage.getItem("username").substring(0, 11) +"...";
                $("label#username").text(usertxt); 
            }
            else
            {
                $("label#username").text(localStorage.getItem("username")); 
            }
            if(localStorage.getItem("role") == "Employee")
            {

                $("div#over_map").hide(10);
                $('div#barchartContents').hide();
                $('div#over_map3').hide();
                $("div#shipmentDetails").hide(100);
                $("div#map").hide(10); 
                $("div#map2").hide(10); 
                $("label#accountlist").removeClass("accountlisttext");
                $("label#accountlist").removeClass("accountlisttext");
                $("label#accountlist").addClass("accountlisttext2");
         
            }
            else if(localStorage.getItem("role")=="Admin")
            {
                $("select#accountlist").addClass("accountlisttext");
                $("select#accountlist").removeClass("accountlisttext2");
            }
          
        }

    </script>
    <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.4/firebase.js"></script>
    <script src="app.js"></script>
    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script>
        var firebaseConfig = {
        apiKey: "AIzaSyAUGHZrYdzCHwEPFWjo3FqjZEr9ZR0a9ow",
        authDomain: "temporarydb-6928e.firebaseapp.com",
        databaseURL: "https://temporarydb-6928e.firebaseio.com",
        projectId: "temporarydb-6928e",
        storageBucket: "temporarydb-6928e.appspot.com",
        messagingSenderId: "623044431745",
        appId: "1:623044431745:web:6b19caf3aa23ff8ed8a280",
        measurementId: "G-XQSTFCN9XV"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
    <script>
            // counter for online cars...
            var div2Temp=0;
            var menuChanged = 0;
            var tempkey;
            var tempkey2;
            var btnSignal = 0;
            var cars_count = 0;
            var x = document.getElementById("shipmentPos");
            var x1 = document.getElementById("shipmentPos2");
            var x2 = document.getElementById("rolesDropdown");
            var empID="";
            var option = document.createElement("option");
            var option2 = document.createElement("option");
            // markers array to store all the markers, so that we could remove marker when any car goes offline and its data will be remove from realtime database...
            var markers = [];
            var markers2 = [];
            var markers3 = [];
            var designationInfo;
            var designationMarker;
            var map;
            var map2;
            var eventMap;
            var cityCircle; 
            var cityCircle2;
            var lngData;
            var latData;
            var distance;
            var line;
            var line2;
            var uluru1;
            var markersArray = [];
            var markersArray2 = [];
            var mk1;
            var mk2;
            function haversine_distance(mk1, mk2) {
                var R = 3958.8; // Radius of the Earth in miles
                var rlat1 = mk1.position.lat() * (Math.PI/180); // Convert degrees to radians
                var rlat2 = mk2.position.lat() * (Math.PI/180); // Convert degrees to radians
                var difflat = rlat2-rlat1; // Radian difference (latitudes)
                var difflon = (mk2.position.lng()-mk1.position.lng()) * (Math.PI/180); // Radian difference (longitudes)
                var d = 2 * R * Math.asin(Math.sqrt(Math.sin(difflat/2)*Math.sin(difflat/2)+Math.cos(rlat1)*Math.cos(rlat2)*Math.sin(difflon/2)*Math.sin(difflon/2)));
                  return d;
                }
            function initMap() { // Google Map Initialization... 
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 6,
                    center: new google.maps.LatLng(34, 121.7740),
                    mapTypeId: 'terrain'
                });
                map2 = new google.maps.Map(document.getElementById('map2'), {
                    zoom: 6,
                    center: new google.maps.LatLng(34, 121.7740),
                    mapTypeId: 'terrain'
                });

            //--------------------------event Map---------------------------------//
                eventMap = new google.maps.Map(document.getElementById('eventMap'), {
                    zoom: 6,
                    center: new google.maps.LatLng(34, 121.7740),
                    mapTypeId: 'terrain'
                });
                        // add a click event handler to the map object
                google.maps.event.addListener(eventMap, "click", function(event)
                {
                    // place a marker
                    placeMarker(event.latLng);
                });
                var icon = { // car icon
                  path: 'M29.395,0H17.636c-3.117,0-5.643,3.467-5.643,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759   c3.116,0,5.644-2.527,5.644-5.644V6.584C35.037,3.467,32.511,0,29.395,0z M34.05,14.188v11.665l-2.729,0.351v-4.806L34.05,14.188z    M32.618,10.773c-1.016,3.9-2.219,8.51-2.219,8.51H16.631l-2.222-8.51C14.41,10.773,23.293,7.755,32.618,10.773z M15.741,21.713   v4.492l-2.73-0.349V14.502L15.741,21.713z M13.011,37.938V27.579l2.73,0.343v8.196L13.011,37.938z M14.568,40.882l2.218-3.336   h13.771l2.219,3.336H14.568z M31.321,35.805v-7.872l2.729-0.355v10.048L31.321,35.805',
                  scale: 0.4,
                  fillColor: "#427af4", //<-- Car Color, you can change it 
                  fillOpacity: 1,
                  strokeWeight: 1,
                  anchor: new google.maps.Point(0, 5),
                //<--  rotation: data.val().angle  Car angle
                  };
             //--------------------------event Map---------------------------------//
            }
            // This Function will create a car icon with angle and add/display that marker on the map
            function AddCar(data) {
                var icon = { // car icon
                    path: 'M29.395,0H17.636c-3.117,0-5.643,3.467-5.643,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759   c3.116,0,5.644-2.527,5.644-5.644V6.584C35.037,3.467,32.511,0,29.395,0z M34.05,14.188v11.665l-2.729,0.351v-4.806L34.05,14.188z    M32.618,10.773c-1.016,3.9-2.219,8.51-2.219,8.51H16.631l-2.222-8.51C14.41,10.773,23.293,7.755,32.618,10.773z M15.741,21.713   v4.492l-2.73-0.349V14.502L15.741,21.713z M13.011,37.938V27.579l2.73,0.343v8.196L13.011,37.938z M14.568,40.882l2.218-3.336   h13.771l2.219,3.336H14.568z M31.321,35.805v-7.872l2.729-0.355v10.048L31.321,35.805',
                    scale: 0.4,
                    fillColor: "#427af4", //<-- Car Color, you can change it 
                    fillOpacity: 1,
                    strokeWeight: 1,
                    anchor: new google.maps.Point(0, 5),
                  //<--  rotation: data.val().angle  Car angle
                    };

                var uluru = { lat: data.val().lat, lng: data.val().lng };
                var marker = new google.maps.Marker({
                    position: uluru,
                });
                 marker.setMap(map);
                var contentString = '<div class="iw-content">' + '<div class="iw-subTitle">ContainerID:'+String(data.val().shipmentID)+' </div>' ;
            // + '<p>455 street</p>' + '<p>City, World</p>' + '<p>Canada, Postalcode</p>' + '</div>'
                
                var infowindow = new google.maps.InfoWindow({
                    content:  contentString
                });
                infowindow.open(map,marker);   
                markers[data.key] = marker; // add marker in the markers array...
                document.getElementById("cars").innerHTML = cars_count;
                //ZOOM when clicked
                google.maps.event.addListener(marker,'click',function() {
                map.setZoom(6);
                map.setCenter(marker.getPosition()); 
                $('#shipmentPos').val(data.val().shipmentID).trigger('change'); 
                $("div#shipmentDetails").show(100);
                $("div#map2").show(100); 
                $("div#map").hide(100); 
                $("div#home").hide(100); 
                $("#inventoryLabel").text(String(data.val().shipmentID));
                if(tempkey != null)
                {
                    markers2[tempkey].setMap(null);  
                    myChart.destroy();
                }
                $("div#over_map").hide(10); 
                chartData();
                btnFollow();
                });
                google.maps.event.addListener(marker,'click',function() {
                var pos = map.getZoom();
                map.setZoom(6);
                map.setCenter(marker.getPosition());
                //window.setTimeout(function() {map.setZoom(pos);},3000);
                });
            }

            function updateData(data)
            {
                var icon = { // car icon
                    path: 'M29.395,0H17.636c-3.117,0-5.643,3.467-5.643,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759   c3.116,0,5.644-2.527,5.644-5.644V6.584C35.037,3.467,32.511,0,29.395,0z M34.05,14.188v11.665l-2.729,0.351v-4.806L34.05,14.188z    M32.618,10.773c-1.016,3.9-2.219,8.51-2.219,8.51H16.631l-2.222-8.51C14.41,10.773,23.293,7.755,32.618,10.773z M15.741,21.713   v4.492l-2.73-0.349V14.502L15.741,21.713z M13.011,37.938V27.579l2.73,0.343v8.196L13.011,37.938z M14.568,40.882l2.218-3.336   h13.771l2.219,3.336H14.568z M31.321,35.805v-7.872l2.729-0.355v10.048L31.321,35.805',
                    scale: 0.4,
                    fillColor: "#427af4", //<-- Car Color, you can change it 
                    fillOpacity: 1,
                    strokeWeight: 1,
                    anchor: new google.maps.Point(0, 5),
                  //<--  rotation: data.val().angle  Car angle
                };
                var uluru = { lat: data.val().lat, lng: data.val().lng };
                var marker2 = new google.maps.Marker({
                    position: uluru,
                });
                 marker2.setMap(map2);
                
                var infowindow = new google.maps.InfoWindow({
                    content:  "ContainerID:"+String(data.val().shipmentID)
                });
                infowindow.open(map2,marker2);    
                markers2[data.key] = marker2; // add marker in the markers array...

                document.getElementById("cars").innerHTML = cars_count;
                //ZOOM when clicked
                google.maps.event.addListener(marker2,'click',function() {
                var pos = map.getZoom();
                map2.setZoom(15);
                map2.setCenter(marker2.getPosition());
                //window.setTimeout(function() {map2.setZoom(pos);},10000);
                }); 

                deleteOverlays2();
                if(String(data.val().radiusLat) !="0")
                {
                designationMarker = { lat: parseInt(data.val().radiusLat), lng: parseInt(data.val().radiusLng) };       
              
                cityCircle2 = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: map2,
                    center: designationMarker,
                    radius:parseInt(data.val().radius)
                });   
      
                var marker = new google.maps.Marker({
                    position: designationMarker, 
                    map: map2
                });
                markersArray2.push(marker);
                designationInfo = new google.maps.InfoWindow({
                    content:  "Designation Place:" +data.val().place
                });
                line2 = new google.maps.Polyline({path: [designationMarker, uluru], map: map2});
                designationInfo.open(map2,marker);   
                
            }
        }
            function eventTracker(data)
            {
                var icon = { // car icon
                    path: 'M29.395,0H17.636c-3.117,0-5.643,3.467-5.643,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759   c3.116,0,5.644-2.527,5.644-5.644V6.584C35.037,3.467,32.511,0,29.395,0z M34.05,14.188v11.665l-2.729,0.351v-4.806L34.05,14.188z    M32.618,10.773c-1.016,3.9-2.219,8.51-2.219,8.51H16.631l-2.222-8.51C14.41,10.773,23.293,7.755,32.618,10.773z M15.741,21.713   v4.492l-2.73-0.349V14.502L15.741,21.713z M13.011,37.938V27.579l2.73,0.343v8.196L13.011,37.938z M14.568,40.882l2.218-3.336   h13.771l2.219,3.336H14.568z M31.321,35.805v-7.872l2.729-0.355v10.048L31.321,35.805',
                    scale: 0.4,
                    fillColor: "#427af4", //<-- Car Color, you can change it 
                    fillOpacity: 1,
                    strokeWeight: 1,
                    anchor: new google.maps.Point(0, 5),
                //<--  rotation: data.val().angle  Car angle
                };
                uluru1 = { lat: data.val().lat, lng: data.val().lng };
                var marker2 = new google.maps.Marker({
                    position: uluru1,
                });
                marker2.setMap(eventMap);
                var infowindow = new google.maps.InfoWindow({
                    content:  "ContainerID:"+String(data.val().shipmentID)
                });
                infowindow.open(eventMap,marker2);    
                markers3[data.key] = marker2; // add marker in the markers array..
                document.getElementById("cars").innerHTML = cars_count;
                //ZOOM when clicked
                google.maps.event.addListener(marker2,'click',function() {
                var pos = map.getZoom();
                eventMap.setZoom(15);
                eventMap.setCenter(marker2.getPosition());
                //window.setTimeout(function() {map2.setZoom(pos);},10000);
                }); 
                deleteOverlays();
                if(String(data.val().radiusLat) !="0")
                {
                designationMarker = { lat: data.val().radiusLat, lng: data.val().radiusLng };       
              
                cityCircle = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: eventMap,
                    center: designationMarker,
                    radius:parseInt(data.val().radius)
                });   
      
                var marker = new google.maps.Marker({
                    position: designationMarker, 
                    map: eventMap
                });
                markersArray.push(marker);
                designationInfo = new google.maps.InfoWindow({
                    content:  "Designation Place:" +data.val().place
                });
                line = new google.maps.Polyline({path: [designationMarker, uluru1], map: eventMap});
                designationInfo.open(eventMap,marker);                          
            }
            /*
            if(String(data.val().radius) !="0")
                {
                    designationSet= (parseInt(data.val().radius) / 1010);
                    designationDistance = { lat: data.val().lat, lng: data.val().lng};
                    shipmentDistance = { lat: parseInt(data.val().radiusLat), lng: parseInt(data.val().radiusLng)};
                    mk1 = new google.maps.Marker({position: designationDistance, map: eventMap});
                    mk2 = new google.maps.Marker({position: shipmentDistance, map: eventMap});
                    distance = haversine_distance(mk1, mk2)*1.595;        
                    markersArray.push(mk1);
                    markersArray.push(mk2);
                 
                    if(distance<= designationSet)
                    {
                    firebase.database().ref('/notifications/notifLoc'+data.val().shipmentID+'').set({
                        text: "Container " + data.val().shipmentID +" is in the area of "  + data.val().place 
                    });
            
                     }
     
                }
                */
            }
            function btnFollow()
                { 
              
                var table3 = document.querySelector('#table3 tbody');
                var table4 = document.querySelector('#table4 tbody');
                var table5 = document.querySelector('#table5 tbody');
                var table6 = document.querySelector('#table6 tbody');
                var shipmentsTable3 = firebase.database().ref()
                .child("/shipmentsTable/monitoringShipments/"+x.value+"/");
                var productTable4 = firebase.database().ref().child("shipmentsProducts/"+x.value+"/");
                var shockTable5 = firebase.database().ref().child("shockTable/"+x.value+"/");
                var doorTable6 = firebase.database().ref().child("doorTable/"+x.value+"/");
                shipmentsTable3.on('value', function(snapshot){
                    while(table3.hasChildNodes()) {
                        table3.removeChild(table3.firstChild);
                    }
                    if(snapshot.exists()){
                        var content = '';
                        snapshot.forEach(function(data){
                            var val = data.val();
                            if(data.val().aShipmentID == x.value)
                            {
                            content +='<tr>';
                            content += '<td>' + val.aShipmentID + '</td>';
                            content += '<td>' + val.bDate + '</td>';
                            content += '<td>' + val.cTime + '</td>';
                            content += '<td>' + val.dCelsius +"C"       + '</td>';
                            content += '<td>' + val.hHumidity + '</td>';
                            content += '<td>' + val.lat + '</td>';
                            content += '<td>' + val.lng + '</td>';
                            content += '</tr>';
                            }
                        });
                        $('#table3 tbody').append(content);
                    }
                });

                productTable4.on('value', function(snapshot){
                    while(table4.hasChildNodes()) {
                        table4.removeChild(table4.firstChild);
                    }
                    if(snapshot.exists()){
                 
                        var content = '';
                        snapshot.forEach(function(data){
                            var val = data.val();
                            if(data.val().aShipmentID == x.value)
                            {
                            content +='<tr>';
                            content += '<td>' + val.aShipmentID + '</td>';
                            content += '<td>' + val.bProdId + '</td>';
                            if(val.cProdDesc == "Blank")
                            {
                            content += '<td>' + '<input type="text" id= text'+val.id+' style="text-align:center;" placeholder="Input product"><img  src="check.jpg" class="textImage" id='+val.id+' onclick=temphi3(this.id)></td>';
                            }
                            else
                            {
                            content += '<td>' + val.cProdDesc + '</td>'; 
                            }
                            content += '<td>' + val.lat + '</td>';
                            content += '<td>' + val.lng + '</td>';
                            content += '</tr>';
                        }
                        });
                        $('#table4 tbody').append(content);
                    }
                });
                            
                shockTable5.on('value', function(snapshot){
                    var tempint = 0;
                    while(table5.hasChildNodes()) {
                        table5.removeChild(table5.firstChild);
                    }
                    if(snapshot.exists()){
                        var content = '';
                        snapshot.forEach(function(data){
                            var val = data.val();
                            tempint = tempint+ 1;
                            if(data.val().shipmentID == x.value)
                            {
                            content +='<tr>';
                            content += '<td>' + String(tempint) + '</td>';
                            content += '<td>' + val.date + '</td>';
                            content += '<td>' + val.time + '</td>';
                            content += '<td>' + String(val.lat) + '</td>';
                            content += '<td>' + String(val.lng) + '</td>';
                            content += '<td>' + "<a href="+ "#!" + " onclick="+"temphi2(this.id)"+" id="+val.imageID+">" + "View Images"+ "</a>"+ '</td>';
                            content += '</tr>';
                        }
                        });
                        $('#table5 tbody').append(content);
                    }
                });

                doorTable6.on('value', function(snapshot){
                    var tempint = 0;
                    while(table6.hasChildNodes()) {
                        table6.removeChild(table6.firstChild);
                    }
                    if(snapshot.exists()){
                        var content = '';
                        snapshot.forEach(function(data){
                            var val = data.val();
                            tempint = tempint+ 1;
                            if(data.val().shipmentID == x.value)
                            {
                            content +='<tr>';
                            content += '<td>' + String(tempint) + '</td>';
                            content += '<td>' + val.startTime + '</td>';
                            content += '<td>' + val.endTime + '</td>';
                            content += '<td>' + "<a href="+ "#!" + " onclick="+"temphi(this.id)"+" id="+val.imageID+">" + "View Images"+ "</a>"+ '</td>';
                            content += '</tr>';
                        }
                        });
                        $('#table6 tbody').append(content);
                    }
                });
                
       
            }
//-----------------------------------for map-------------------------------//
            // get firebase database reference...
            var cars_Ref = firebase.database().ref('/location/shipments');
            // this event will be triggered when a new object will be added in the database...
            cars_Ref.on('child_added', function (data) {
                cars_count++;
                AddCar(data); 
                var option = document.createElement("option");
                option.text = String(data.val().shipmentID);
                x.add(option);   
                var option2 = document.createElement("option");
                option2.text = String(data.val().shipmentID);
                x1.add(option2);   
            });
            // this event will be triggered on location change of any car...
            cars_Ref.on('child_changed', function (data) {
                markers[data.key].setMap(null);
                AddCar(data);
                if(data.val().shipmentID == x.value)
                {
                    markers2[data.key].setMap(null); 
                    updateData(data);
                }
                if(data.val().shipmentID == x1.value)
                {
                    markers3[data.key].setMap(null); 
                    eventTracker(data);
                }
            });
                    // If any car goes offline then this event will get triggered and we'll remove the marker of that car...  
             cars_Ref.on('child_removed', function (data) {
                markers[data.key].setMap(null);
                markers2[data.key].setMap(null);
                cars_count--;
                document.getElementById("cars").innerHTML = cars_count;
            });

//-----------------------------------for map-------------------------------//
//-----------------------------------for employee-------------------------------//
 
       
       
            
//-----------------------------------for employee-------------------------------//
    
         

            function temphi (clicked_id) {
                alert(clicked_id);
                var tableImage = document.querySelector('#List tr');
                while(tableImage.hasChildNodes()) {
                    tableImage.removeChild(tableImage.firstChild);
                    }
                var storageRef = storage.ref(x.value+'/');
                $('#List').find('tr').html('');
                var i = 0;
                storageRef.child(clicked_id).listAll().then(function(result){
                result.items.forEach(function(imageRef){
                //console.log("Image reference" + imageRef.toString());
                i++;
                displayImage(i,imageRef);
                });
                });
                function displayImage(row,images)
                {
                    images.getDownloadURL().then(function(url){
                    console.log(url);
                    let new_html = '';
                    new_html +='<td >';
                    new_html +='<img src="'+url+'" id="image '+ row + '" width = "300px" height = "400px" alt=" '+ row + '"onclick=temphi4(this.id)>';
                    new_html +='</td>';
                    $('#List').find('tr').append(new_html);
                    });
                }
             }

             function temphi2 (clicked_id) { 
                var tableImage3 = document.querySelector('#List3 tr');
                while(tableImage3.hasChildNodes()) {
                    tableImage3.removeChild(tableImage3.firstChild);
                    }

                var storageRef = storage.ref(x.value+'/');
                $('#List3').find('tr').html('');
                var i = 0;
               
                storageRef.child(clicked_id).listAll().then(function(result){
                result.items.forEach(function(imageRef){
                //console.log("Image reference" + imageRef.toString());
                i++;
               
                displayImage(i,imageRef);
                });
                });
                function displayImage(row,images)
                {
                    images.getDownloadURL().then(function(url){
                    console.log(url);
                    let new_html = '';
                    new_html +='<td >';
                    new_html +='<img src="'+url+'" id="image '+ row + '" width = "300px" height = "400px"alt=" '+ row + '"onclick=temphi4(this.id)>';
                    new_html +='</td>';
                    $('#List3').find('tr').append(new_html);
                    });
                }
             }
             function temphi3(clicked_id)
             {
                var inputText = document.getElementById("text"+clicked_id+"").value;
                
                var prodUpdate =firebase.database().ref().child('/shipmentsProducts/'+x.value+'/'+clicked_id+'');
                prodUpdate.update({
                cProdDesc: inputText
                 });
                 alert("Product Updated")
                }
        </script>
     <script>
           
        
            function startCam ()
            {
                var changeimage = firebase.database().ref().child("startCam/"+x.value+"/");
                var tableImage2 = document.querySelector('#List2 tr');
                var tempchange= 0;
                firebase.database().ref().child("startCam/"+x.value+"/").set({
                start: "1" 
            });
     
            $("label#lblsnapshot").show(); 
            $("Table#List2").hide(); 
            document.getElementById("stopBtn").disabled = true;
            changeimage.on('value', function (data) {
        
                if(data.val().start == "0" && tempchange ==0)
                {
                   
                 tempchange =1;
                 document.getElementById("stopBtn").disabled = false;
                $("table#List2").show(); 
                $("label#lblsnapshot").hide(); 
             
                var storageRef = storage.ref('snapshots/');
                $('#List2').find('tr').html('');
                var i = 0;
                
                storageRef.listAll().then(function(result){
                result.items.forEach(function(imageRef){
                //console.log("Image reference" + imageRef.toString());
                i++;
                displayImage(i,imageRef);
                });
                });
                function displayImage(row,images)
                {
                    images.getDownloadURL().then(function(url){
                    console.log(url);
                    let new_html = '';
                    new_html +='<td >';
                    new_html +='<img src="'+url+'" id="image '+ row + '" width = "300px" height = "400px" alt=" '+ row+ '"onclick=temphi4(this.id)>';
                    new_html +='</td>';
                    $('#List2').find('tr').append(new_html);
                    });
                }
                }
            });  
            }
 
         
            function deleteall()
            {
                var changeimage = firebase.database().ref().child("startCam/"+x.value+"/");
         var tableImage2 = document.querySelector('#List2 tr');
                alert("Images deleted")
                while(tableImage2.hasChildNodes()) {
                    tableImage2.removeChild(tableImage2.firstChild);
                    }
                var storageRef = storage.ref('snapshots/');
    
              storageRef.listAll().then(function(res) {
              res.items.forEach(function(itemRef) {
            
              var gsReference = storage.refFromURL(itemRef.toString()).delete().then(function() {
      
              });
            
              });
              });

            
            }
 
    </script>
    <script>
        function temphi4(clicked_id)
        {
            var id =clicked_id;
                 // Get the modal
                 var modal = document.getElementById("myModal");
                  // Get the image and insert it inside the modal - use its "alt" text as a caption
                 var img = document.getElementById(String(id));
                 var modalImg = document.getElementById("img01");
                 var captionText = document.getElementById("caption");
                 img.onclick = function(){ 
                 modal.style.display = "block";
                 modalImg.src = this.src;
                 captionText.innerHTML = this.alt;
                }
                    // Get the <span> element that closes the modal
                    var span = document.getElementsByClassName("close")[0];
                    // When the user clicks on <span> (x), close the modal
                    span.onclick = function() { 
                    modal.style.display = "none";
                }
        }
       
    </script>
    <script>
        var coll = document.getElementsByClassName("collapsible");
        var i;
        for (i = 0; i < coll.length; i++) {
          coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
              content.style.maxHeight = null;
            } else {
              content.style.maxHeight = content.scrollHeight + "px";
            } 
          });
        }
        </script>
        <script src="eventMap.js"></script>   
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC7DtKqWoAtgKFmYtUu-PceyA7bV1Y9NTU&callback=initMap">
        </script>
        <script src="https://static.fusioncharts.com/code/latest/fusioncharts.js"></script>
        <script src="jqueryMain.js"></script>   
        <script src="chart.js"></script>    
        <script src="barChartGraph.js"></script>   
        <script src="account.js"></script>  
        <script src="notif.js"></script> 
        <script src="roles.js"></script>   
    </body>
</html>
